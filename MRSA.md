Data-driven valuation on MALDI-TOF MS data of S. aureus
================

This is an example of [the second layer of
DARTA](https://github.com/HsinYaoWang/DARTA#layer-of-data-driven-valuation-on-data),
**Layer of data-driven valuation on data**, with MALDI-TOF MS data of
S. aureus.

## Data format

### HL7 FHIR

Laboratory data in [HL7 FHIR](https://hl7.org/fhir/) format, an
international standard for EHR, with [observation
resource](https://hl7.org/fhir/observation.html) can be used as an input
for DARTA.

### Basic lab data format

Basic lab data format with individual ID, laboratory test ID (or unique
name), date, test results.

### Analysis-ready data format

Analysis-ready data is composed of rows representing records, each with
a unique ID and all variables arranged in columns (showing only part of
columns).

| 2000.10055247 | 2582.4357238000052 | 3143.8104086700328 | 3951.1877523200333 | 5150.225256870018 | 6385.8788357600015 | 7577.816246340053 | MRSA | SPC | RCV.DATE   | GENDER |  AGE |
|--------------:|-------------------:|-------------------:|-------------------:|------------------:|-------------------:|------------------:|:-----|:----|:-----------|:-------|-----:|
|     0.0000000 |                  0 |                  0 |          0.0000000 |         0.0000000 |                  0 |                 0 | 0    | W   | 2018-03-06 | M      | 54.4 |
|     0.0000000 |                  0 |                  0 |          0.0000000 |         0.0000000 |                  0 |                 0 | 1    | W   | 2018-08-13 | M      | 60.0 |
|     0.0000000 |                  0 |                  0 |          0.0000000 |         0.0275108 |                  0 |                 0 | 0    | R   | 2019-01-02 | M      | 80.8 |
|     0.0000000 |                  0 |                  0 |          0.0000000 |         0.0237329 |                  0 |                 0 | 0    | F   | 2019-05-15 | F      | 75.9 |
|     0.0000000 |                  0 |                  0 |          0.0000000 |         0.0000000 |                  0 |                 0 | 0    | B   | 2014-01-22 | M      | 62.0 |
|     0.0279616 |                  0 |                  0 |          0.0000000 |         0.0000000 |                  0 |                 0 | 1    | W   | 2014-08-13 | F      | 37.8 |
|     0.0000000 |                  0 |                  0 |          0.0119375 |         0.0000000 |                  0 |                 0 | 1    | W   | 2015-02-23 | F      | 66.8 |
|     0.0067489 |                  0 |                  0 |          0.0000000 |         0.0000000 |                  0 |                 0 | 1    | W   | 2015-10-15 | M      | 11.6 |
|     0.0000000 |                  0 |                  0 |          0.0000000 |         0.0000000 |                  0 |                 0 | 1    | R   | 2016-04-28 | M      | 61.3 |
|     0.0153024 |                  0 |                  0 |          0.0000000 |         0.0000000 |                  0 |                 0 | 1    | OT  | 2016-10-27 | F      | 85.3 |

## Data metrics for valuation on IPFS/FVM

### Degree of rarity, exclusive/non-exclusive licensing

1.  Is there any publicly available dataset similar with the submitted
    data? (Yes/No)
    - No. There is no publicly available MALDI-TOF MS data of S. aureus
2.  Licensing option. (exclusive/non-exclusive)
    - Non-exclusive

### Data usability and sharing options

1.  Can data be shared directly? (Yes/No)
    - Yes
2.  If data cannot be shared directly, provide the federated learning
    frameworks. (TensorFlow Federated/NVIDIA CLARA/OpenFL/Flower/etc.)
    - Not applicable (data can be shared directly)

### Amount of data

1.  Number of records
    - 29,276
2.  Number of variables
    - 736

### Characteristics

1.  Demographic stats
    - Age ![](MRSA_files/figure-gfm/age-1.png)<!-- -->
    - Sex ![](MRSA_files/figure-gfm/sex-1.png)<!-- -->
2.  Feature skewness / kurtosis (showing only part of columns)

|                                                  |                             |
|:-------------------------------------------------|:----------------------------|
| Name                                             | SA\[, c(seq(1, 700, 100), … |
| Number of rows                                   | 29276                       |
| Number of columns                                | 12                          |
| \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_   |                             |
| Column type frequency:                           |                             |
| character                                        | 2                           |
| Date                                             | 1                           |
| factor                                           | 1                           |
| numeric                                          | 8                           |
| \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_ |                             |
| Group variables                                  | None                        |

Data summary

**Variable type: character**

| skim_variable | n_missing | complete_rate | min | max | empty | n_unique | whitespace |
|:--------------|----------:|--------------:|----:|----:|------:|---------:|-----------:|
| SPC           |         0 |             1 |   1 |   2 |     0 |        6 |          0 |
| GENDER        |         0 |             1 |   1 |   1 |     0 |        3 |          0 |

**Variable type: Date**

| skim_variable | n_missing | complete_rate | min        | max        | median     | n_unique |
|:--------------|----------:|--------------:|:-----------|:-----------|:-----------|---------:|
| RCV.DATE      |         0 |             1 | 2013-06-13 | 2019-06-29 | 2016-12-14 |     2110 |

**Variable type: factor**

| skim_variable | n_missing | complete_rate | ordered | n_unique | top_counts         |
|:--------------|----------:|--------------:|:--------|---------:|:-------------------|
| MRSA          |         0 |             1 | FALSE   |        2 | 1: 14918, 0: 14358 |

**Variable type: numeric**

| skim_variable      | n_missing | complete_rate |  mean |    sd |  p0 |  p25 |  p50 |  p75 |   p100 | hist  |
|:-------------------|----------:|--------------:|------:|------:|----:|-----:|-----:|-----:|-------:|:------|
| 2000.10055247      |         0 |             1 |  0.01 |  0.02 |   0 |  0.0 |  0.0 |  0.0 |   0.75 | ▇▁▁▁▁ |
| 2582.4357238000052 |         0 |             1 |  0.00 |  0.02 |   0 |  0.0 |  0.0 |  0.0 |   1.00 | ▇▁▁▁▁ |
| 3143.8104086700328 |         0 |             1 |  0.00 |  0.01 |   0 |  0.0 |  0.0 |  0.0 |   0.57 | ▇▁▁▁▁ |
| 3951.1877523200333 |         0 |             1 |  0.00 |  0.01 |   0 |  0.0 |  0.0 |  0.0 |   0.39 | ▇▁▁▁▁ |
| 5150.225256870018  |         0 |             1 |  0.00 |  0.01 |   0 |  0.0 |  0.0 |  0.0 |   0.65 | ▇▁▁▁▁ |
| 6385.8788357600015 |         0 |             1 |  0.00 |  0.01 |   0 |  0.0 |  0.0 |  0.0 |   0.80 | ▇▁▁▁▁ |
| 7577.816246340053  |         0 |             1 |  0.00 |  0.03 |   0 |  0.0 |  0.0 |  0.0 |   1.00 | ▇▁▁▁▁ |
| AGE                |         0 |             1 | 54.70 | 24.16 |   0 | 40.8 | 58.9 | 73.1 | 105.30 | ▃▃▇▇▂ |

Skewness & Kurtosis

|                    | Skewness |  Kurtosis |
|:-------------------|---------:|----------:|
| 2000.10055247      | 10.10454 |  257.4169 |
| 2582.4357238000052 | 18.59535 |  601.5791 |
| 3143.8104086700328 | 22.81317 |  713.6678 |
| 3951.1877523200333 | 18.04539 |  729.6641 |
| 5150.225256870018  | 22.27487 |  802.3878 |
| 6385.8788357600015 | 25.11646 | 1052.6361 |
| 7577.816246340053  | 14.22138 |  282.1984 |

### Data characteristics change over time

Data characteristics in different years

|                                | 2013           | 2014           | 2015           | 2016           | 2017           | 2018           | 2019           | p       | test |
|:-------------------------------|:---------------|:---------------|:---------------|:---------------|:---------------|:---------------|:---------------|:--------|:-----|
| n                              | 1284           | 4546           | 4115           | 4949           | 4924           | 5922           | 3536           |         |      |
| 2000.10055247 (mean (SD))      | 0.03 (0.04)    | 0.01 (0.02)    | 0.01 (0.01)    | 0.01 (0.01)    | 0.00 (0.01)    | 0.00 (0.01)    | 0.00 (0.01)    | \<0.001 |      |
| 2582.4357238000052 (mean (SD)) | 0.01 (0.03)    | 0.00 (0.03)    | 0.00 (0.02)    | 0.00 (0.01)    | 0.00 (0.02)    | 0.00 (0.02)    | 0.00 (0.01)    | \<0.001 |      |
| 3143.8104086700328 (mean (SD)) | 0.01 (0.04)    | 0.00 (0.02)    | 0.00 (0.01)    | 0.00 (0.01)    | 0.00 (0.01)    | 0.00 (0.01)    | 0.00 (0.01)    | \<0.001 |      |
| 3951.1877523200333 (mean (SD)) | 0.00 (0.01)    | 0.00 (0.01)    | 0.00 (0.00)    | 0.00 (0.01)    | 0.00 (0.01)    | 0.00 (0.01)    | 0.00 (0.00)    | \<0.001 |      |
| 5150.225256870018 (mean (SD))  | 0.01 (0.04)    | 0.00 (0.02)    | 0.00 (0.02)    | 0.00 (0.01)    | 0.00 (0.01)    | 0.00 (0.01)    | 0.00 (0.01)    | \<0.001 |      |
| 6385.8788357600015 (mean (SD)) | 0.01 (0.04)    | 0.00 (0.01)    | 0.00 (0.01)    | 0.00 (0.01)    | 0.00 (0.01)    | 0.00 (0.02)    | 0.00 (0.01)    | \<0.001 |      |
| 7577.816246340053 (mean (SD))  | 0.01 (0.06)    | 0.00 (0.02)    | 0.00 (0.02)    | 0.00 (0.02)    | 0.01 (0.03)    | 0.00 (0.04)    | 0.00 (0.03)    | \<0.001 |      |
| MRSA = 1 (%)                   | 727 (56.6)     | 2426 (53.4)    | 2220 (53.9)    | 2599 (52.5)    | 2429 (49.3)    | 2779 (46.9)    | 1738 (49.2)    | \<0.001 |      |
| SPC (%)                        |                |                |                |                |                |                |                | \<0.001 |      |
| B                              | 191 (14.9)     | 435 ( 9.6)     | 510 (12.4)     | 637 (12.9)     | 578 (11.7)     | 527 ( 8.9)     | 293 ( 8.3)     |         |      |
| F                              | 41 ( 3.2)      | 150 ( 3.3)     | 127 ( 3.1)     | 167 ( 3.4)     | 182 ( 3.7)     | 208 ( 3.5)     | 112 ( 3.2)     |         |      |
| OT                             | 76 ( 5.9)      | 314 ( 6.9)     | 302 ( 7.3)     | 362 ( 7.3)     | 407 ( 8.3)     | 628 (10.6)     | 277 ( 7.8)     |         |      |
| R                              | 370 (28.8)     | 1278 (28.1)    | 1049 (25.5)    | 1141 (23.1)    | 923 (18.7)     | 1149 (19.4)    | 788 (22.3)     |         |      |
| U                              | 86 ( 6.7)      | 251 ( 5.5)     | 224 ( 5.4)     | 309 ( 6.2)     | 312 ( 6.3)     | 366 ( 6.2)     | 211 ( 6.0)     |         |      |
| W                              | 520 (40.5)     | 2118 (46.6)    | 1903 (46.2)    | 2333 (47.1)    | 2522 (51.2)    | 3044 (51.4)    | 1855 (52.5)    |         |      |
| GENDER (%)                     |                |                |                |                |                |                |                | \<0.001 |      |
| ?                              | 0 ( 0.0)       | 0 ( 0.0)       | 0 ( 0.0)       | 0 ( 0.0)       | 0 ( 0.0)       | 4 ( 0.1)       | 7 ( 0.2)       |         |      |
| F                              | 507 (39.5)     | 1851 (40.7)    | 1620 (39.4)    | 2028 (41.0)    | 2011 (40.8)    | 2401 (40.5)    | 1411 (39.9)    |         |      |
| M                              | 777 (60.5)     | 2695 (59.3)    | 2495 (60.6)    | 2921 (59.0)    | 2913 (59.2)    | 3517 (59.4)    | 2118 (59.9)    |         |      |
| AGE (mean (SD))                | 54.75 (24.74)  | 54.54 (24.53)  | 54.63 (24.41)  | 54.85 (24.51)  | 54.39 (23.94)  | 55.34 (23.68)  | 54.17 (23.74)  | 0.312   |      |
| Year (mean (SD))               | 2013.00 (0.00) | 2014.00 (0.00) | 2015.00 (0.00) | 2016.00 (0.00) | 2017.00 (0.00) | 2018.00 (0.00) | 2019.00 (0.00) | \<0.001 |      |

### Data heterogeneity checking

1.  Data characteristics in different folds (showing only part of
    columns)
    - Randomly split the dataset into 10 folds

    - Check the differences between these 10 folds

|                                | 1                      | 2                      | 3                      | 4                      | 5                      | 6                      | 7                      | 8                      | 9                      | 10                     | p       | test |
|:-------------------------------|:-----------------------|:-----------------------|:-----------------------|:-----------------------|:-----------------------|:-----------------------|:-----------------------|:-----------------------|:-----------------------|:-----------------------|:--------|:-----|
| n                              | 2928                   | 2928                   | 2928                   | 2927                   | 2927                   | 2927                   | 2927                   | 2928                   | 2928                   | 2928                   |         |      |
| 2000.10055247 (mean (SD))      | 0.01 (0.02)            | 0.01 (0.01)            | 0.01 (0.02)            | 0.01 (0.01)            | 0.01 (0.02)            | 0.01 (0.02)            | 0.01 (0.02)            | 0.01 (0.02)            | 0.01 (0.02)            | 0.01 (0.01)            | 0.687   |      |
| 2582.4357238000052 (mean (SD)) | 0.00 (0.01)            | 0.00 (0.02)            | 0.00 (0.01)            | 0.00 (0.02)            | 0.00 (0.02)            | 0.00 (0.03)            | 0.00 (0.02)            | 0.00 (0.02)            | 0.00 (0.02)            | 0.00 (0.02)            | 0.454   |      |
| 3143.8104086700328 (mean (SD)) | 0.00 (0.01)            | 0.00 (0.01)            | 0.00 (0.02)            | 0.00 (0.01)            | 0.00 (0.01)            | 0.00 (0.02)            | 0.00 (0.01)            | 0.00 (0.02)            | 0.00 (0.01)            | 0.00 (0.01)            | 0.546   |      |
| 3951.1877523200333 (mean (SD)) | 0.00 (0.01)            | 0.00 (0.01)            | 0.00 (0.01)            | 0.00 (0.01)            | 0.00 (0.01)            | 0.00 (0.01)            | 0.00 (0.00)            | 0.00 (0.00)            | 0.00 (0.00)            | 0.00 (0.01)            | 0.253   |      |
| 5150.225256870018 (mean (SD))  | 0.00 (0.02)            | 0.00 (0.01)            | 0.00 (0.02)            | 0.00 (0.01)            | 0.00 (0.01)            | 0.00 (0.01)            | 0.00 (0.01)            | 0.00 (0.01)            | 0.00 (0.01)            | 0.00 (0.01)            | 0.057   |      |
| 6385.8788357600015 (mean (SD)) | 0.00 (0.01)            | 0.00 (0.01)            | 0.00 (0.02)            | 0.00 (0.01)            | 0.00 (0.01)            | 0.00 (0.01)            | 0.00 (0.02)            | 0.00 (0.02)            | 0.00 (0.02)            | 0.00 (0.01)            | 0.804   |      |
| 7577.816246340053 (mean (SD))  | 0.00 (0.03)            | 0.00 (0.03)            | 0.00 (0.03)            | 0.00 (0.02)            | 0.00 (0.03)            | 0.01 (0.03)            | 0.00 (0.03)            | 0.00 (0.03)            | 0.00 (0.03)            | 0.01 (0.04)            | 0.579   |      |
| MRSA = 1 (%)                   | 1492 (51.0)            | 1492 (51.0)            | 1492 (51.0)            | 1492 (51.0)            | 1491 (50.9)            | 1492 (51.0)            | 1491 (50.9)            | 1492 (51.0)            | 1492 (51.0)            | 1492 (51.0)            | 1.000   |      |
| SPC (%)                        |                        |                        |                        |                        |                        |                        |                        |                        |                        |                        | 0.719   |      |
| B                              | 300 (10.2)             | 306 (10.5)             | 338 (11.5)             | 319 (10.9)             | 279 ( 9.5)             | 338 (11.5)             | 308 (10.5)             | 358 (12.2)             | 303 (10.3)             | 322 (11.0)             |         |      |
| F                              | 110 ( 3.8)             | 95 ( 3.2)              | 105 ( 3.6)             | 99 ( 3.4)              | 95 ( 3.2)              | 95 ( 3.2)              | 99 ( 3.4)              | 105 ( 3.6)             | 84 ( 2.9)              | 100 ( 3.4)             |         |      |
| OT                             | 219 ( 7.5)             | 233 ( 8.0)             | 235 ( 8.0)             | 228 ( 7.8)             | 242 ( 8.3)             | 241 ( 8.2)             | 249 ( 8.5)             | 252 ( 8.6)             | 241 ( 8.2)             | 226 ( 7.7)             |         |      |
| R                              | 692 (23.6)             | 648 (22.1)             | 668 (22.8)             | 636 (21.7)             | 699 (23.9)             | 681 (23.3)             | 655 (22.4)             | 655 (22.4)             | 676 (23.1)             | 688 (23.5)             |         |      |
| U                              | 175 ( 6.0)             | 186 ( 6.4)             | 162 ( 5.5)             | 184 ( 6.3)             | 168 ( 5.7)             | 170 ( 5.8)             | 175 ( 6.0)             | 173 ( 5.9)             | 171 ( 5.8)             | 195 ( 6.7)             |         |      |
| W                              | 1432 (48.9)            | 1460 (49.9)            | 1420 (48.5)            | 1461 (49.9)            | 1444 (49.3)            | 1402 (47.9)            | 1441 (49.2)            | 1385 (47.3)            | 1453 (49.6)            | 1397 (47.7)            |         |      |
| RCV.DATE (mean (SD))           | 20164429.96 (17603.98) | 20164270.04 (17581.06) | 20163835.66 (17624.20) | 20164271.88 (17383.78) | 20164484.34 (17565.98) | 20164089.24 (17429.69) | 20164224.80 (17393.59) | 20164091.32 (17468.03) | 20164165.33 (17639.67) | 20164048.59 (17529.18) | 0.960   |      |
| GENDER (%)                     |                        |                        |                        |                        |                        |                        |                        |                        |                        |                        | 0.535   |      |
| ?                              | 2 ( 0.1)               | 1 ( 0.0)               | 0 ( 0.0)               | 1 ( 0.0)               | 0 ( 0.0)               | 2 ( 0.1)               | 1 ( 0.0)               | 2 ( 0.1)               | 2 ( 0.1)               | 0 ( 0.0)               |         |      |
| F                              | 1131 (38.6)            | 1201 (41.0)            | 1179 (40.3)            | 1177 (40.2)            | 1221 (41.7)            | 1141 (39.0)            | 1209 (41.3)            | 1182 (40.4)            | 1181 (40.3)            | 1207 (41.2)            |         |      |
| M                              | 1795 (61.3)            | 1726 (58.9)            | 1749 (59.7)            | 1749 (59.8)            | 1706 (58.3)            | 1784 (60.9)            | 1717 (58.7)            | 1744 (59.6)            | 1745 (59.6)            | 1721 (58.8)            |         |      |
| AGE (mean (SD))                | 54.98 (23.81)          | 53.62 (24.65)          | 54.87 (24.18)          | 54.56 (24.48)          | 54.82 (24.04)          | 55.50 (23.84)          | 55.11 (23.91)          | 54.23 (24.02)          | 54.74 (24.31)          | 54.60 (24.29)          | 0.227   |      |
| Fold (mean (SD))               | 1.00 (0.00)            | 2.00 (0.00)            | 3.00 (0.00)            | 4.00 (0.00)            | 5.00 (0.00)            | 6.00 (0.00)            | 7.00 (0.00)            | 8.00 (0.00)            | 9.00 (0.00)            | 10.00 (0.00)           | \<0.001 |      |

2.  Models performances in different folds

| nth fold |     AUROC |
|---------:|----------:|
|        1 | 0.9021112 |
|        2 | 0.9321544 |
|        3 | 0.9118530 |
|        4 | 0.9077576 |
|        5 | 0.9210733 |
|        6 | 0.9411723 |
|        7 | 0.8960336 |
|        8 | 0.9044635 |
|        9 | 0.9218301 |
|       10 | 0.9083058 |

3.  Cluster analysis for outliers detection
    ![](MRSA_files/figure-gfm/PCA-1.png)<!-- -->

### Duplication checking

1.  Training data size impact on model performance

- Sequentially add data (add 1/10 data per round) to the model
  development process and check the performance changes

| Number of records |     AUROC |
|------------------:|----------:|
|              2928 | 0.9228569 |
|              5856 | 0.9246231 |
|              8784 | 0.9373923 |
|             11711 | 0.9288732 |
|             14638 | 0.9457878 |
|             17565 | 0.9381082 |
|             20492 | 0.9384858 |
|             23420 | 0.9327313 |
|             26348 | 0.9376587 |
|             29276 | 0.9396530 |
